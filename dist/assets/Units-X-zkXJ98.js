import{r as i,q as B,j as e,n as I,T as $,B as h,O,G as P,h as k,C as p,A as W,I as b}from"./index-CV1bxkLI.js";import{P as G}from"./PageHeader-Dveo8Ckr.js";import{F as V}from"./FormModal-DDGPMrd0.js";import{d as H,c as K,u as Q}from"./mockData-DhN2TBgL.js";/* empty css                 */import{F as n}from"./index-ChYIY3iE.js";import{C as N}from"./index-CJpspubW.js";import{F as _}from"./Table-CQO6drIt.js";import{T as A}from"./index-CMSFhQ_d.js";import"./ReloadOutlined-D_5bXhqo.js";import"./useForm-Dj05K5iH.js";import"./index-BHUsVD3h.js";const{Text:x}=$,j=K(Q),oe=()=>{const[v,E]=i.useState(!0),[a,C]=i.useState(null),[S,o]=i.useState([]),[R,d]=i.useState(!1),[r,U]=i.useState(null),[c]=n.useForm(),{showSuccess:f,showError:g}=B(),u=H.slice(0,5);i.useEffect(()=>{(async()=>{try{const s=await j.getAll();o(s.data)}catch{g("Failed to fetch units")}finally{E(!1)}})(),u.length>0&&C(u[0].id)},[]);const T=S.filter(t=>t.courseId===a).sort((t,s)=>t.unitNumber-s.unitNumber),z=i.useMemo(()=>[{title:"Unit",dataIndex:"unitNumber",key:"unitNumber",width:80,render:t=>e.jsxs(I,{color:"blue",children:["Unit ",t]})},{title:"Title",dataIndex:"title",key:"title",render:(t,s)=>e.jsxs("div",{children:[e.jsx(x,{strong:!0,children:t}),s.description&&e.jsx("div",{style:{fontSize:12,color:"var(--color-text-tertiary)"},children:s.description})]})},{title:"Weightage",dataIndex:"weightage",key:"weightage",width:100,render:t=>`${t||0}%`},{title:"Topics",dataIndex:"topics",key:"topics",width:100,render:t=>e.jsxs(I,{children:[(t==null?void 0:t.length)||0," topics"]})},{title:"Actions",key:"actions",width:100,render:(t,s)=>e.jsxs(h.Group,{size:"small",children:[e.jsx(h,{type:"text",icon:e.jsx(O,{}),onClick:()=>M(s)}),e.jsx(h,{type:"text",danger:!0,icon:e.jsx(P,{}),onClick:()=>L(s)})]})}],[]),D=()=>{U(null),c.resetFields(),d(!0)},M=t=>{var s;U(t),c.setFieldsValue({...t,topics:(s=t.topics)==null?void 0:s.join(", ")}),d(!0)},L=async t=>{try{await j.delete(t.id),o(s=>s.filter(m=>m.id!==t.id)),f("Unit deleted")}catch{g("Failed to delete")}},q=async t=>{var s;try{const m={...t,courseId:a,topics:(s=t.topics)==null?void 0:s.split(",").map(l=>l.trim()).filter(Boolean)};if(r){const l=await j.update(r.id,m);o(y=>y.map(w=>w.id===r.id?{...w,...l.data}:w)),f("Unit updated")}else{const l=await j.create(m);o(y=>[...y,l.data]),f("Unit added")}d(!1),c.resetFields()}catch{g("Failed to save")}},F=u.find(t=>t.id===a);return e.jsxs("div",{className:"crud-page",children:[e.jsx(G,{title:"Unit Management",subtitle:"Define units/chapters for your courses",showAdd:!1,showRefresh:!1}),e.jsxs(k,{gutter:24,children:[e.jsx(p,{xs:24,md:8,children:e.jsx(N,{title:"My Courses",size:"small",children:u.map(t=>e.jsxs("div",{className:`mapping-item ${a===t.id?"selected":""}`,onClick:()=>C(t.id),children:[e.jsxs("div",{children:[e.jsx(x,{strong:!0,children:t.name}),e.jsx("br",{}),e.jsx(x,{type:"secondary",style:{fontSize:12},children:t.code})]}),e.jsxs(I,{children:[S.filter(s=>s.courseId===t.id).length," units"]})]},t.id))})}),e.jsx(p,{xs:24,md:16,children:e.jsx(N,{title:e.jsxs("span",{children:["Course Units",F&&e.jsxs(x,{type:"secondary",style:{fontWeight:"normal",marginLeft:8},children:["for ",F.name]})]}),extra:e.jsx(h,{type:"primary",icon:e.jsx(W,{}),onClick:D,disabled:!a,children:"Add Unit"}),size:"small",children:e.jsx(_,{dataSource:T,columns:z,rowKey:"id",loading:v,pagination:!1,size:"small",locale:{emptyText:"No units defined for this course"}})})})]}),e.jsxs(V,{title:r?"Edit Unit":"Add Unit",open:R,onClose:()=>d(!1),onSubmit:q,form:c,initialValues:r||{unitNumber:T.length+1,weightage:20},children:[e.jsxs(k,{gutter:16,children:[e.jsx(p,{span:12,children:e.jsx(n.Item,{name:"unitNumber",label:"Unit Number",rules:[{required:!0,message:"Required"}],children:e.jsx(A,{min:1,max:10,style:{width:"100%"}})})}),e.jsx(p,{span:12,children:e.jsx(n.Item,{name:"weightage",label:"Weightage (%)",children:e.jsx(A,{min:0,max:100,style:{width:"100%"}})})})]}),e.jsx(n.Item,{name:"title",label:"Unit Title",rules:[{required:!0,message:"Please enter unit title"}],children:e.jsx(b,{placeholder:"e.g., Introduction to Data Structures"})}),e.jsx(n.Item,{name:"description",label:"Description",children:e.jsx(b.TextArea,{rows:2,placeholder:"Brief description"})}),e.jsx(n.Item,{name:"topics",label:"Topics (comma-separated)",extra:"List the topics covered in this unit",children:e.jsx(b.TextArea,{rows:2,placeholder:"e.g., Arrays, Linked Lists, Stacks, Queues"})})]})]})};export{oe as default};
