import{r as n,n as W,j as t,aQ as v,B as Y,aH as z,I as J}from"./index-Dam5Oft4.js";import{P as X}from"./PageHeader-CZTgCyCQ.js";import{D as Z}from"./DataTable-CdlHlVvB.js";import{F as ee}from"./FormModal-DAw8X4uI.js";import{B as te,R as se}from"./BulkUpload-Df8m5uJ0.js";import{u as j,k as b,d as O,j as T,l as q,c as le,q as oe}from"./mockData-Cb9OjNPh.js";/* empty css                 */import{F as r}from"./index-BKD578Au.js";import{T as ae,C as ie,b as re,R,a as u}from"./index-FCt6_Que.js";import{T as p}from"./index-B2mNOki0.js";import{S as i}from"./Pagination-Uk28cVne.js";import{R as ne}from"./Table-C6DyXLPW.js";import"./ReloadOutlined-DwAtovzj.js";import"./index-DuDzpR4g.js";import"./DeleteOutlined-B7Ves8ci.js";import"./index-B4TLLAPK.js";import"./DownloadOutlined-BqSPMs8z.js";import"./index-CIaEzPBK.js";import"./progress-DnPM2Sxy.js";import"./index-D3Ga-QO6.js";import"./useForm-Boa0LRH0.js";import"./index-CrsKlaQM.js";const{Text:de}=ae,{TextArea:B}=J,I=le(oe),Oe=()=>{const[w,h]=n.useState([]),[g,C]=n.useState(!0),[U,f]=n.useState(!1),[a,L]=n.useState(null),[D,E]=n.useState("list"),[c]=r.useForm(),{showSuccess:x,showError:y}=W(),[l,d]=n.useState({courseId:null,unitId:null,bloomLevelId:null,difficultyLevelId:null,questionType:null}),k=O.slice(0,5),S=async()=>{C(!0);try{const e=await I.getAll();h(e.data)}catch{y("Failed to fetch questions")}finally{C(!1)}};n.useEffect(()=>{S()},[]);const F=n.useMemo(()=>w.filter(e=>!(l.courseId&&e.courseId!==l.courseId||l.unitId&&e.unitId!==l.unitId||l.bloomLevelId&&e.bloomLevelId!==l.bloomLevelId||l.difficultyLevelId&&e.difficultyLevelId!==l.difficultyLevelId||l.questionType&&e.questionType!==l.questionType)),[w,l]),Q=l.courseId?j.filter(e=>e.courseId===l.courseId):j,$=l.courseId||a!=null&&a.courseId?b.filter(e=>e.courseId===(l.courseId||(a==null?void 0:a.courseId))):b,A=n.useMemo(()=>[{title:"Question",dataIndex:"questionText",key:"questionText",ellipsis:!0,render:e=>t.jsx("div",{style:{maxWidth:400},children:t.jsx(de,{ellipsis:{tooltip:e},children:e})})},{title:"Course",dataIndex:"courseId",key:"courseId",width:100,render:e=>{const s=O.find(o=>o.id===e);return s?t.jsx(p,{children:s.code}):"-"}},{title:"Unit",dataIndex:"unitId",key:"unitId",width:80,render:e=>{const s=j.find(o=>o.id===e);return s?`U${s.unitNumber}`:"-"}},{title:"CO",dataIndex:"courseOutcomeId",key:"courseOutcomeId",width:70,render:e=>{const s=b.find(o=>o.id===e);return s?t.jsxs(p,{color:"purple",children:["CO",s.coNumber]}):"-"}},{title:"Bloom",dataIndex:"bloomLevelId",key:"bloomLevelId",width:100,render:e=>{const s=T.find(o=>o.id===e);return s?t.jsxs(p,{color:"blue",children:["L",s.level]}):"-"}},{title:"Difficulty",dataIndex:"difficultyLevelId",key:"difficultyLevelId",width:100,render:e=>{const s=q.find(m=>m.id===e),o={easy:"green",medium:"orange",hard:"red"};return s?t.jsx(p,{color:o[s.name.toLowerCase()],children:s.name}):"-"}},{title:"Type",dataIndex:"questionType",key:"questionType",width:100,render:e=>{const s=v.find(o=>o.value===e);return t.jsx(p,{children:(s==null?void 0:s.label)||e})}},{title:"Marks",dataIndex:"marks",key:"marks",width:70,align:"center"}],[]),N=()=>{L(null),c.resetFields(),l.courseId&&c.setFieldsValue({courseId:l.courseId}),f(!0)},M=e=>{L(e),c.setFieldsValue(e),f(!0)},P=async e=>{try{await I.delete(e.id),h(s=>s.filter(o=>o.id!==e.id)),x("Question deleted")}catch{y("Failed to delete")}},K=async e=>{try{if(a){const s=await I.update(a.id,e);h(o=>o.map(m=>m.id===a.id?{...m,...s.data}:m)),x("Question updated")}else{const s=await I.create(e);h(o=>[...o,s.data]),x("Question added")}f(!1),c.resetFields()}catch{y("Failed to save")}},V=async()=>new Promise(e=>{setTimeout(()=>{e({success:!0,message:"Questions imported successfully",data:{success:10,failed:0}})},2e3)}),H=()=>{d({courseId:null,unitId:null,bloomLevelId:null,difficultyLevelId:null,questionType:null})},_=Object.values(l).some(Boolean),G=[{key:"list",label:t.jsxs("span",{children:[t.jsx(z,{})," Questions (",F.length,")"]}),children:t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"filter-bar",children:[t.jsx(i,{placeholder:"Filter by Course",value:l.courseId,onChange:e=>d(s=>({...s,courseId:e,unitId:null})),style:{width:180},allowClear:!0,options:k.map(e=>({value:e.id,label:e.code}))}),t.jsx(i,{placeholder:"Filter by Unit",value:l.unitId,onChange:e=>d(s=>({...s,unitId:e})),style:{width:150},allowClear:!0,disabled:!l.courseId,options:Q.map(e=>({value:e.id,label:`Unit ${e.unitNumber}`}))}),t.jsx(i,{placeholder:"Bloom Level",value:l.bloomLevelId,onChange:e=>d(s=>({...s,bloomLevelId:e})),style:{width:150},allowClear:!0,options:T.map(e=>({value:e.id,label:`L${e.level} - ${e.name}`}))}),t.jsx(i,{placeholder:"Difficulty",value:l.difficultyLevelId,onChange:e=>d(s=>({...s,difficultyLevelId:e})),style:{width:130},allowClear:!0,options:q.map(e=>({value:e.id,label:e.name}))}),t.jsx(i,{placeholder:"Type",value:l.questionType,onChange:e=>d(s=>({...s,questionType:e})),style:{width:130},allowClear:!0,options:v}),_&&t.jsx(Y,{onClick:H,children:"Clear Filters"})]}),t.jsx(Z,{tableId:"questions",columns:A,dataSource:F,loading:g,searchKeys:["questionText"],onEdit:M,onDelete:P,showSearch:!0,emptyText:"No Questions Found",emptyDescription:"Add questions using the form or bulk upload."})]})},{key:"upload",label:t.jsxs("span",{children:[t.jsx(se,{})," Bulk Upload"]}),children:t.jsx("div",{style:{padding:24},children:t.jsx(te,{onUpload:V,onDownloadTemplate:()=>x("Template download started"),templateName:"questions_template.xlsx",title:"Upload Questions",description:"Upload an Excel file with questions",hint:"Required: Question Text, Course, Unit, CO, Bloom Level, Difficulty, Type, Marks"})})}];return t.jsxs("div",{className:"crud-page",children:[t.jsx(X,{title:"Question Bank",subtitle:"Manage questions with CO and Bloom level mapping",onAdd:N,addText:"Add Question",onRefresh:S,loading:g}),t.jsx(ie,{className:"content-card",children:t.jsx(re,{activeKey:D,onChange:E,items:G,style:{marginTop:-16}})}),t.jsxs(ee,{title:a?"Edit Question":"Add Question",open:U,onClose:()=>f(!1),onSubmit:K,form:c,initialValues:a||{marks:5,questionType:"short"},width:800,children:[t.jsx(r.Item,{name:"questionText",label:"Question Text",rules:[{required:!0,message:"Please enter question"}],children:t.jsx(B,{rows:4,placeholder:"Enter the question text"})}),t.jsxs(R,{gutter:16,children:[t.jsx(u,{span:8,children:t.jsx(r.Item,{name:"courseId",label:"Course",rules:[{required:!0,message:"Required"}],children:t.jsx(i,{placeholder:"Select course",options:k.map(e=>({value:e.id,label:`${e.code} - ${e.name}`}))})})}),t.jsx(u,{span:8,children:t.jsx(r.Item,{name:"unitId",label:"Unit",rules:[{required:!0,message:"Required"}],children:t.jsx(i,{placeholder:"Select unit",options:Q.map(e=>({value:e.id,label:`Unit ${e.unitNumber} - ${e.title}`}))})})}),t.jsx(u,{span:8,children:t.jsx(r.Item,{name:"courseOutcomeId",label:"Course Outcome",rules:[{required:!0,message:"Required"}],children:t.jsx(i,{placeholder:"Select CO",options:$.map(e=>({value:e.id,label:`CO${e.coNumber}`}))})})})]}),t.jsxs(R,{gutter:16,children:[t.jsx(u,{span:8,children:t.jsx(r.Item,{name:"bloomLevelId",label:"Bloom Level",rules:[{required:!0,message:"Required"}],children:t.jsx(i,{placeholder:"Select Bloom level",options:T.map(e=>({value:e.id,label:`L${e.level} - ${e.name}`}))})})}),t.jsx(u,{span:8,children:t.jsx(r.Item,{name:"difficultyLevelId",label:"Difficulty",rules:[{required:!0,message:"Required"}],children:t.jsx(i,{placeholder:"Select difficulty",options:q.map(e=>({value:e.id,label:e.name}))})})}),t.jsx(u,{span:8,children:t.jsx(r.Item,{name:"marks",label:"Marks",rules:[{required:!0,message:"Required"}],children:t.jsx(i,{placeholder:"Select marks",options:[1,2,3,4,5,6,7,8,10,12,15,20].map(e=>({value:e,label:`${e} marks`}))})})})]}),t.jsx(r.Item,{name:"questionType",label:"Question Type",rules:[{required:!0,message:"Required"}],children:t.jsx(ne.Group,{options:v,optionType:"button",buttonStyle:"solid"})}),t.jsx(r.Item,{name:"expectedAnswer",label:"Expected Answer / Key Points (Optional)",children:t.jsx(B,{rows:3,placeholder:"Key points or expected answer for reference"})})]})]})};export{Oe as default};
