import{r as n,q as H,j as t,T as Y,n as p,b6 as v,t as i,B as z,aW as J,w as X,I as Z,h as Q,C as u}from"./index-CV1bxkLI.js";import{P as ee}from"./PageHeader-Dveo8Ckr.js";import{D as te}from"./DataTable-BML9nD9J.js";import{F as se}from"./FormModal-DDGPMrd0.js";import{B as le,R as oe}from"./BulkUpload-Brn-OanA.js";import{u as j,k as b,d as R,j as q,l as w,c as ae,q as ie}from"./mockData-DhN2TBgL.js";import{d as re}from"./downloadHelper-BRzppvwq.js";/* empty css                 */import{F as r}from"./index-ChYIY3iE.js";import{C as ne}from"./index-CJpspubW.js";import{R as de}from"./Table-CQO6drIt.js";import"./ReloadOutlined-D_5bXhqo.js";import"./index-D8x57Z7c.js";import"./DownloadOutlined-C8503EmU.js";import"./index-BV6MVHCX.js";import"./progress-BAB7NLHo.js";import"./index-DJSLK9Tr.js";import"./useForm-Dj05K5iH.js";import"./index-BHUsVD3h.js";const{Text:ue}=Y,{TextArea:B}=Z,I=ae(ie),Fe=()=>{const[T,h]=n.useState([]),[C,g]=n.useState(!0),[U,f]=n.useState(!1),[a,L]=n.useState(null),[D,E]=n.useState("list"),[c]=r.useForm(),{showSuccess:x,showError:y}=H(),[l,d]=n.useState({courseId:null,unitId:null,bloomLevelId:null,difficultyLevelId:null,questionType:null}),k=R.slice(0,5),S=async()=>{g(!0);try{const e=await I.getAll();h(e.data)}catch{y("Failed to fetch questions")}finally{g(!1)}};n.useEffect(()=>{S()},[]);const F=n.useMemo(()=>T.filter(e=>!(l.courseId&&e.courseId!==l.courseId||l.unitId&&e.unitId!==l.unitId||l.bloomLevelId&&e.bloomLevelId!==l.bloomLevelId||l.difficultyLevelId&&e.difficultyLevelId!==l.difficultyLevelId||l.questionType&&e.questionType!==l.questionType)),[T,l]),O=l.courseId?j.filter(e=>e.courseId===l.courseId):j,$=l.courseId||a!=null&&a.courseId?b.filter(e=>e.courseId===(l.courseId||(a==null?void 0:a.courseId))):b,A=n.useMemo(()=>[{title:"Question",dataIndex:"questionText",key:"questionText",ellipsis:!0,render:e=>t.jsx("div",{style:{maxWidth:400},children:t.jsx(ue,{ellipsis:{tooltip:e},children:e})})},{title:"Course",dataIndex:"courseId",key:"courseId",width:100,render:e=>{const s=R.find(o=>o.id===e);return s?t.jsx(p,{children:s.code}):"-"}},{title:"Unit",dataIndex:"unitId",key:"unitId",width:80,render:e=>{const s=j.find(o=>o.id===e);return s?`U${s.unitNumber}`:"-"}},{title:"CO",dataIndex:"courseOutcomeId",key:"courseOutcomeId",width:70,render:e=>{const s=b.find(o=>o.id===e);return s?t.jsxs(p,{color:"purple",children:["CO",s.coNumber]}):"-"}},{title:"Bloom",dataIndex:"bloomLevelId",key:"bloomLevelId",width:100,render:e=>{const s=q.find(o=>o.id===e);return s?t.jsxs(p,{color:"blue",children:["L",s.level]}):"-"}},{title:"Difficulty",dataIndex:"difficultyLevelId",key:"difficultyLevelId",width:100,render:e=>{const s=w.find(m=>m.id===e),o={easy:"green",medium:"orange",hard:"red"};return s?t.jsx(p,{color:o[s.name.toLowerCase()],children:s.name}):"-"}},{title:"Type",dataIndex:"questionType",key:"questionType",width:100,render:e=>{const s=v.find(o=>o.value===e);return t.jsx(p,{children:(s==null?void 0:s.label)||e})}},{title:"Marks",dataIndex:"marks",key:"marks",width:70,align:"center"}],[]),N=()=>{L(null),c.resetFields(),l.courseId&&c.setFieldsValue({courseId:l.courseId}),f(!0)},M=e=>{L(e),c.setFieldsValue(e),f(!0)},P=async e=>{try{await I.delete(e.id),h(s=>s.filter(o=>o.id!==e.id)),x("Question deleted")}catch{y("Failed to delete")}},K=async e=>{try{if(a){const s=await I.update(a.id,e);h(o=>o.map(m=>m.id===a.id?{...m,...s.data}:m)),x("Question updated")}else{const s=await I.create(e);h(o=>[...o,s.data]),x("Question added")}f(!1),c.resetFields()}catch{y("Failed to save")}},_=async()=>new Promise(e=>{setTimeout(()=>{e({success:!0,message:"Questions imported successfully",data:{success:10,failed:0}})},2e3)}),V=()=>{d({courseId:null,unitId:null,bloomLevelId:null,difficultyLevelId:null,questionType:null})},W=Object.values(l).some(Boolean),G=[{key:"list",label:t.jsxs("span",{children:[t.jsx(J,{})," Questions (",F.length,")"]}),children:t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"filter-bar",children:[t.jsx(i,{placeholder:"Filter by Course",value:l.courseId,onChange:e=>d(s=>({...s,courseId:e,unitId:null})),style:{width:180},allowClear:!0,options:k.map(e=>({value:e.id,label:e.code}))}),t.jsx(i,{placeholder:"Filter by Unit",value:l.unitId,onChange:e=>d(s=>({...s,unitId:e})),style:{width:150},allowClear:!0,disabled:!l.courseId,options:O.map(e=>({value:e.id,label:`Unit ${e.unitNumber}`}))}),t.jsx(i,{placeholder:"Bloom Level",value:l.bloomLevelId,onChange:e=>d(s=>({...s,bloomLevelId:e})),style:{width:150},allowClear:!0,options:q.map(e=>({value:e.id,label:`L${e.level} - ${e.name}`}))}),t.jsx(i,{placeholder:"Difficulty",value:l.difficultyLevelId,onChange:e=>d(s=>({...s,difficultyLevelId:e})),style:{width:130},allowClear:!0,options:w.map(e=>({value:e.id,label:e.name}))}),t.jsx(i,{placeholder:"Type",value:l.questionType,onChange:e=>d(s=>({...s,questionType:e})),style:{width:130},allowClear:!0,options:v}),W&&t.jsx(z,{onClick:V,children:"Clear Filters"})]}),t.jsx(te,{tableId:"questions",columns:A,dataSource:F,loading:C,searchKeys:["questionText"],onEdit:M,onDelete:P,showSearch:!0,emptyText:"No Questions Found",emptyDescription:"Add questions using the form or bulk upload."})]})},{key:"upload",label:t.jsxs("span",{children:[t.jsx(oe,{})," Bulk Upload"]}),children:t.jsx("div",{style:{padding:24},children:t.jsx(le,{onUpload:_,onDownloadTemplate:()=>{re("/templates/questions_template.csv","questions_template.csv"),x("Template download started")},templateName:"questions_template.csv",title:"Upload Questions",description:"Upload an Excel file with questions",hint:"Required: Question Text, Course, Unit, CO, Bloom Level, Difficulty, Type, Marks"})})}];return t.jsxs("div",{className:"crud-page",children:[t.jsx(ee,{title:"Question Bank",subtitle:"Manage questions with CO and Bloom level mapping",onAdd:N,addText:"Add Question",onRefresh:S,loading:C}),t.jsx(ne,{className:"content-card",children:t.jsx(X,{activeKey:D,onChange:E,items:G,style:{marginTop:-16}})}),t.jsxs(se,{title:a?"Edit Question":"Add Question",open:U,onClose:()=>f(!1),onSubmit:K,form:c,initialValues:a||{marks:5,questionType:"short"},width:800,children:[t.jsx(r.Item,{name:"questionText",label:"Question Text",rules:[{required:!0,message:"Please enter question"}],children:t.jsx(B,{rows:4,placeholder:"Enter the question text"})}),t.jsxs(Q,{gutter:16,children:[t.jsx(u,{span:8,children:t.jsx(r.Item,{name:"courseId",label:"Course",rules:[{required:!0,message:"Required"}],children:t.jsx(i,{placeholder:"Select course",options:k.map(e=>({value:e.id,label:`${e.code} - ${e.name}`}))})})}),t.jsx(u,{span:8,children:t.jsx(r.Item,{name:"unitId",label:"Unit",rules:[{required:!0,message:"Required"}],children:t.jsx(i,{placeholder:"Select unit",options:O.map(e=>({value:e.id,label:`Unit ${e.unitNumber} - ${e.title}`}))})})}),t.jsx(u,{span:8,children:t.jsx(r.Item,{name:"courseOutcomeId",label:"Course Outcome",rules:[{required:!0,message:"Required"}],children:t.jsx(i,{placeholder:"Select CO",options:$.map(e=>({value:e.id,label:`CO${e.coNumber}`}))})})})]}),t.jsxs(Q,{gutter:16,children:[t.jsx(u,{span:8,children:t.jsx(r.Item,{name:"bloomLevelId",label:"Bloom Level",rules:[{required:!0,message:"Required"}],children:t.jsx(i,{placeholder:"Select Bloom level",options:q.map(e=>({value:e.id,label:`L${e.level} - ${e.name}`}))})})}),t.jsx(u,{span:8,children:t.jsx(r.Item,{name:"difficultyLevelId",label:"Difficulty",rules:[{required:!0,message:"Required"}],children:t.jsx(i,{placeholder:"Select difficulty",options:w.map(e=>({value:e.id,label:e.name}))})})}),t.jsx(u,{span:8,children:t.jsx(r.Item,{name:"marks",label:"Marks",rules:[{required:!0,message:"Required"}],children:t.jsx(i,{placeholder:"Select marks",options:[1,2,3,4,5,6,7,8,10,12,15,20].map(e=>({value:e,label:`${e} marks`}))})})})]}),t.jsx(r.Item,{name:"questionType",label:"Question Type",rules:[{required:!0,message:"Required"}],children:t.jsx(de.Group,{options:v,optionType:"button",buttonStyle:"solid"})}),t.jsx(r.Item,{name:"expectedAnswer",label:"Expected Answer / Key Points (Optional)",children:t.jsx(B,{rows:3,placeholder:"Key points or expected answer for reference"})})]})]})};export{Fe as default};
