import{r as i,n as $,j as e,B as p,I}from"./index-Dam5Oft4.js";import{P as q}from"./PageHeader-CZTgCyCQ.js";import{F as P}from"./FormModal-DAw8X4uI.js";import{d as W,c as O,u as V}from"./mockData-Cb9OjNPh.js";/* empty css                 */import{F as n}from"./index-BKD578Au.js";import{T as b}from"./index-B2mNOki0.js";import{T as G,d as H,R as k,a as h,C as N,c as K}from"./index-FCt6_Que.js";import{R as Q}from"./DeleteOutlined-B7Ves8ci.js";import{F as _}from"./Table-C6DyXLPW.js";import{T as A}from"./index-CA2Oabsq.js";import"./ReloadOutlined-DwAtovzj.js";import"./index-B4TLLAPK.js";import"./useForm-Boa0LRH0.js";import"./Pagination-Uk28cVne.js";import"./index-CrsKlaQM.js";const{Text:x}=G,f=O(V),ue=()=>{const[R,v]=i.useState(!0),[r,S]=i.useState(null),[C,l]=i.useState([]),[E,d]=i.useState(!1),[a,T]=i.useState(null),[c]=n.useForm(),{showSuccess:j,showError:g}=$(),m=W.slice(0,5);i.useEffect(()=>{(async()=>{try{const s=await f.getAll();l(s.data)}catch{g("Failed to fetch units")}finally{v(!1)}})(),m.length>0&&S(m[0].id)},[]);const U=C.filter(t=>t.courseId===r).sort((t,s)=>t.unitNumber-s.unitNumber),z=i.useMemo(()=>[{title:"Unit",dataIndex:"unitNumber",key:"unitNumber",width:80,render:t=>e.jsxs(b,{color:"blue",children:["Unit ",t]})},{title:"Title",dataIndex:"title",key:"title",render:(t,s)=>e.jsxs("div",{children:[e.jsx(x,{strong:!0,children:t}),s.description&&e.jsx("div",{style:{fontSize:12,color:"var(--color-text-tertiary)"},children:s.description})]})},{title:"Weightage",dataIndex:"weightage",key:"weightage",width:100,render:t=>`${t||0}%`},{title:"Topics",dataIndex:"topics",key:"topics",width:100,render:t=>e.jsxs(b,{children:[(t==null?void 0:t.length)||0," topics"]})},{title:"Actions",key:"actions",width:100,render:(t,s)=>e.jsxs(p.Group,{size:"small",children:[e.jsx(p,{type:"text",icon:e.jsx(H,{}),onClick:()=>M(s)}),e.jsx(p,{type:"text",danger:!0,icon:e.jsx(Q,{}),onClick:()=>L(s)})]})}],[]),D=()=>{T(null),c.resetFields(),d(!0)},M=t=>{var s;T(t),c.setFieldsValue({...t,topics:(s=t.topics)==null?void 0:s.join(", ")}),d(!0)},L=async t=>{try{await f.delete(t.id),l(s=>s.filter(u=>u.id!==t.id)),j("Unit deleted")}catch{g("Failed to delete")}},B=async t=>{var s;try{const u={...t,courseId:r,topics:(s=t.topics)==null?void 0:s.split(",").map(o=>o.trim()).filter(Boolean)};if(a){const o=await f.update(a.id,u);l(y=>y.map(w=>w.id===a.id?{...w,...o.data}:w)),j("Unit updated")}else{const o=await f.create(u);l(y=>[...y,o.data]),j("Unit added")}d(!1),c.resetFields()}catch{g("Failed to save")}},F=m.find(t=>t.id===r);return e.jsxs("div",{className:"crud-page",children:[e.jsx(q,{title:"Unit Management",subtitle:"Define units/chapters for your courses",showAdd:!1,showRefresh:!1}),e.jsxs(k,{gutter:24,children:[e.jsx(h,{xs:24,md:8,children:e.jsx(N,{title:"My Courses",size:"small",children:m.map(t=>e.jsxs("div",{className:`mapping-item ${r===t.id?"selected":""}`,onClick:()=>S(t.id),children:[e.jsxs("div",{children:[e.jsx(x,{strong:!0,children:t.name}),e.jsx("br",{}),e.jsx(x,{type:"secondary",style:{fontSize:12},children:t.code})]}),e.jsxs(b,{children:[C.filter(s=>s.courseId===t.id).length," units"]})]},t.id))})}),e.jsx(h,{xs:24,md:16,children:e.jsx(N,{title:e.jsxs("span",{children:["Course Units",F&&e.jsxs(x,{type:"secondary",style:{fontWeight:"normal",marginLeft:8},children:["for ",F.name]})]}),extra:e.jsx(p,{type:"primary",icon:e.jsx(K,{}),onClick:D,disabled:!r,children:"Add Unit"}),size:"small",children:e.jsx(_,{dataSource:U,columns:z,rowKey:"id",loading:R,pagination:!1,size:"small",locale:{emptyText:"No units defined for this course"}})})})]}),e.jsxs(P,{title:a?"Edit Unit":"Add Unit",open:E,onClose:()=>d(!1),onSubmit:B,form:c,initialValues:a||{unitNumber:U.length+1,weightage:20},children:[e.jsxs(k,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsx(n.Item,{name:"unitNumber",label:"Unit Number",rules:[{required:!0,message:"Required"}],children:e.jsx(A,{min:1,max:10,style:{width:"100%"}})})}),e.jsx(h,{span:12,children:e.jsx(n.Item,{name:"weightage",label:"Weightage (%)",children:e.jsx(A,{min:0,max:100,style:{width:"100%"}})})})]}),e.jsx(n.Item,{name:"title",label:"Unit Title",rules:[{required:!0,message:"Please enter unit title"}],children:e.jsx(I,{placeholder:"e.g., Introduction to Data Structures"})}),e.jsx(n.Item,{name:"description",label:"Description",children:e.jsx(I.TextArea,{rows:2,placeholder:"Brief description"})}),e.jsx(n.Item,{name:"topics",label:"Topics (comma-separated)",extra:"List the topics covered in this unit",children:e.jsx(I.TextArea,{rows:2,placeholder:"e.g., Arrays, Linked Lists, Stacks, Queues"})})]})]})};export{ue as default};
